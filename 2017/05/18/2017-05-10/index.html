<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">














    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            Andorid——自定义注解实战 | 
        
        Zksyp的博客
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" href="/img/favicon.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="android自定义注解实战根据Java注解基础中所讲述到的知识，java的注解主要分为源码级，编译时与运行时。所以android的自定义注解也主要分为源码级自定义注解，编译时自定义注解和运行时自定义注解。">
    <meta name="keywords" content="null,Android学习">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Zksyp的博客">
    <meta name="msapplication-starturl" content="http://zksyp.com/2017/05/18/2017-05-10/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Zksyp的博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://zksyp.com/2017/05/18/2017-05-10/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Andorid——自定义注解实战 | Zksyp的博客">
    <meta property="og:image" content="/img/favicon.png">
    <meta property="og:description" content="android自定义注解实战根据Java注解基础中所讲述到的知识，java的注解主要分为源码级，编译时与运行时。所以android的自定义注解也主要分为源码级自定义注解，编译时自定义注解和运行时自定义注解。">
    <meta property="og:article:tag" content="Android学习"> 

    
        <meta property="article:published_time" content="Thu May 18 2017 00:00:00 GMT+0800">
        <meta property="article:modified_time" content="Sun Apr 08 2018 14:50:03 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://zksyp.com/2017/05/18/2017-05-10/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://zksyp.com/2017/05/18/2017-05-10/index.html",
    "headline": "Andorid——自定义注解实战",
    "datePublished": "Thu May 18 2017 00:00:00 GMT+0800",
    "dateModified": "Sun Apr 08 2018 14:50:03 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Zksyp",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "Love is a touch but yet not a touch"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Zksyp的博客",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon.png"
        }
    },
    "keywords": ",Android学习null",
    "description": "android自定义注解实战根据Java注解基础中所讲述到的知识，java的注解主要分为源码级，编译时与运行时。所以android的自定义注解也主要分为源码级自定义注解，编译时自定义注解和运行时自定义注解。",
}
</script>


    

    <!-- Analytics -->
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?6853e70ac535757519759c6d1688b5ce';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#android自定义注解实战"><span class="post-toc-number">1.</span> <span class="post-toc-text">android自定义注解实战</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一-源码级自定义注解"><span class="post-toc-number">2.</span> <span class="post-toc-text">一 源码级自定义注解</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二-运行时自定义注解"><span class="post-toc-number">3.</span> <span class="post-toc-text">二 运行时自定义注解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#运行时注解的处理"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">运行时注解的处理</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三-编译时自定义注解"><span class="post-toc-number">4.</span> <span class="post-toc-text">三 编译时自定义注解</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编译时注解的处理"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">编译时注解的处理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注解处理器"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">注解处理器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1-新建一个自定义注解处理器工程"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">1 新建一个自定义注解处理器工程</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2-自定义注解处理器"><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">2 自定义注解处理器</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#自定义注解处理所用的常用元素与常用接口介绍"><span class="post-toc-number">4.2.3.</span> <span class="post-toc-text">自定义注解处理所用的常用元素与常用接口介绍</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-注册自定义注解处理器"><span class="post-toc-number">4.2.4.</span> <span class="post-toc-text">3 注册自定义注解处理器</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自定义BindViewDemo"><span class="post-toc-number">5.</span> <span class="post-toc-text">自定义BindViewDemo</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一-使用运行时自定义注解BindView"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">一 使用运行时自定义注解BindView</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第一步：自定义运行时BindView注解"><span class="post-toc-number">5.1.1.</span> <span class="post-toc-text">第一步：自定义运行时BindView注解:</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第二步：处理运行时BindView注解："><span class="post-toc-number">5.1.2.</span> <span class="post-toc-text">第二步：处理运行时BindView注解：</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#二-使用编译时自定义注解BindView："><span class="post-toc-number">5.2.</span> <span class="post-toc-text">二 使用编译时自定义注解BindView：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第一步：自定义编译时BindView注解"><span class="post-toc-number">5.2.1.</span> <span class="post-toc-text">第一步：自定义编译时BindView注解:</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#第二步：处理编译时BindView注解"><span class="post-toc-number">5.2.2.</span> <span class="post-toc-text">第二步：处理编译时BindView注解:</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#初始化操作与配置："><span class="post-toc-number">5.2.2.1.</span> <span class="post-toc-text">初始化操作与配置：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#注解处理："><span class="post-toc-number">5.2.2.2.</span> <span class="post-toc-text">注解处理：</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#方法一："><span class="post-toc-number">5.2.2.3.</span> <span class="post-toc-text">方法一：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#编译生成的文件"><span class="post-toc-number">5.2.2.3.1.</span> <span class="post-toc-text">编译生成的文件</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#前期处理："><span class="post-toc-number">5.2.2.3.2.</span> <span class="post-toc-text">前期处理：</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#调用方法：BindViewTest-bind"><span class="post-toc-number">5.2.2.3.3.</span> <span class="post-toc-text">调用方法：BindViewTest.bind()</span></a></li></ol></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#方法二："><span class="post-toc-number">5.2.2.4.</span> <span class="post-toc-text">方法二：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#编译生成的文件-1"><span class="post-toc-number">5.2.2.4.1.</span> <span class="post-toc-text">编译生成的文件</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#抽出来的工具类方法："><span class="post-toc-number">5.2.2.4.2.</span> <span class="post-toc-text">抽出来的工具类方法：</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#调用方法：BindViewTest2"><span class="post-toc-number">5.2.2.4.3.</span> <span class="post-toc-text">调用方法：BindViewTest2()</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#小结"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">小结</span></a></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Andorid——自定义注解实战
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Zksyp</strong>
        <span>5月 18, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Android学习/">Android学习</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Andorid——自定义注解实战&url=http://zksyp.com/2017/05/18/2017-05-10/index.html&pic=http://zksyp.com/img/favicon.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://zksyp.com/2017/05/18/2017-05-10/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Zksyp的博客&title=Andorid——自定义注解实战&summary=普通Android搬砖工一枚&pics=http://zksyp.com/img/favicon.png&url=http://zksyp.com/2017/05/18/2017-05-10/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="android自定义注解实战"><a href="#android自定义注解实战" class="headerlink" title="android自定义注解实战"></a>android自定义注解实战</h2><p>根据<a href="http://zksyp.me/2017/05/09/2017-05-09/" target="_blank" rel="external">Java注解基础中所讲述到的知识</a>，<br>java的注解主要分为源码级，编译时与运行时。所以android的自定义注解也主要分为源码级自定义注解，编译时自定义注解和运行时自定义注解。</p>
<a id="more"></a>
<h2 id="一-源码级自定义注解"><a href="#一-源码级自定义注解" class="headerlink" title="一 源码级自定义注解"></a>一 源码级自定义注解</h2><p>源码级注解指的是<code>@Retention</code>为SOURCE的Annotation.</p>
<p>通常用来例如检查重载(<code>@Override</code>)，设置过时(<code>@Deprecated</code>)，抑制警告(<code>@SuppressWarnings</code>)等。这类注解通常是为编译器开发者服务的。</p>
<h2 id="二-运行时自定义注解"><a href="#二-运行时自定义注解" class="headerlink" title="二 运行时自定义注解"></a>二 运行时自定义注解</h2><p>运行时注解指的是<code>@Retention</code>为RUNTIME的Annotation.</p>
<h3 id="运行时注解的处理"><a href="#运行时注解的处理" class="headerlink" title="运行时注解的处理"></a>运行时注解的处理</h3><p>运行时注解的处理主要通过java.lang.reflect包下的AnnotateElement接口中的方法来实现的。主要的方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//如果存在该元素的指定类型的注释，则返回这些注释，否则返回 null。</span></div><div class="line">&lt;T extends Annotation&gt; <span class="function">T <span class="title">getAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span> </span></div><div class="line"></div><div class="line"><span class="comment">//返回此元素上存在的所有注释。</span></div><div class="line">Annotation[] <span class="title">getAnnotations</span><span class="params">()</span> </div><div class="line"></div><div class="line"><span class="comment">//返回直接存在于此元素上的所有注释。(但不包括继承的注释)</span></div><div class="line"> Annotation[] <span class="title">getDeclaredAnnotations</span><span class="params">()</span> </div><div class="line"> </div><div class="line"><span class="comment">//如果指定类型的注释存在于此元素上，则返回 true，否则返回 false。</span></div><div class="line"> <span class="keyword">boolean</span> <span class="title">isAnnotationPresent</span><span class="params">(Class&lt;? extends Annotation&gt; annotationClass)</span></div></pre></td></tr></table></figure>
<p>java中有以下几个类实现了AnnotationElement接口：<br><code>Class</code>;<code>Constructor</code>;<code>Field</code>;<code>Method</code>;<code>Package</code>.<br>所以若注解的生命周期是运行时，我们只需要通过反射得到相应的class，method，constructor,就可以通过相应的方法得到注解和注解的内容，然后在调用相关的方法就可以了。</p>
<h2 id="三-编译时自定义注解"><a href="#三-编译时自定义注解" class="headerlink" title="三 编译时自定义注解"></a>三 编译时自定义注解</h2><p>编译时注解指的是<code>@Retention</code>为<code>CLASS</code>的Annotation.</p>
<h3 id="编译时注解的处理"><a href="#编译时注解的处理" class="headerlink" title="编译时注解的处理"></a>编译时注解的处理</h3><p>编译时注解的处理是由注解处理器(AnnotationProcessor)来完成的。</p>
<h3 id="注解处理器"><a href="#注解处理器" class="headerlink" title="注解处理器"></a>注解处理器</h3><p>注解处理器是javac的一个工具，它用来在编译时扫描和处理注解（Annotation）。你可以自定义注解，并注册到相应的注解处理器，由注解处理器来处理你的注解。一个注解的注解处理器，以Java代码（或者编译过的字节码）作为输入，生成文件（通常是.java文件）作为输出。这些生成的Java代码是在生成的.java文件中，所以你不能修改已经存在的Java类，例如向已有的类中添加方法。这些生成的Java文件，会同其他普通的手动编写的Java源代码一样被javac编译。编译完成之后，程序在运行时就可以使用这些代码。</p>
<p>这里我只是大致了解它的用法，至于深层次的原理待下次的跟进研究。</p>
<h4 id="1-新建一个自定义注解处理器工程"><a href="#1-新建一个自定义注解处理器工程" class="headerlink" title="1 新建一个自定义注解处理器工程"></a>1 新建一个自定义注解处理器工程</h4><p>在andorid环境下并没有自定义注解所需要的api，所以我们需要新建一个纯java工程。</p>
<h4 id="2-自定义注解处理器"><a href="#2-自定义注解处理器" class="headerlink" title="2 自定义注解处理器"></a>2 自定义注解处理器</h4><p>为了处理我们自定义的编译时注解，我们需要自定义注解处理器。<br>自定义注解处理器需要继承AbstractProcessor类。<br><img src="http://og407vfi8.bkt.clouddn.com/14951622011016.jpg" alt=""></p>
<p>如上图，我们主要需要重写上述几个方法：</p>
<ul>
<li><p>Set<string> getSupportedAnnotationTypes()：这是指定处理器处理的注解类型，也就是我们自定义的注解。(这个方法我们可以用注解@SupportedAnnotationTypes()来替代)。</string></p>
</li>
<li><p>SourceVersion getSupportedSourceVersion()：这是指定使用的java版本.(同上，这个方法可以用注解@SupportedSourceVersion()来替代)\n</p>
</li>
<li><p>init(ProcessingEnviornment env)：这是注解处理器类的构造函数，里面含有ProcessingEnviornment 参数，它提供了很多有用的工具类Elements,Types和Filer。</p>
</li>
<li><p>process(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)：这是处理器的核心函数，里面进行一系列的注解的处理。其中参数roundEnv可以获取到所需要的被特殊注解所注解的所有元素。</p>
<h4 id="自定义注解处理所用的常用元素与常用接口介绍"><a href="#自定义注解处理所用的常用元素与常用接口介绍" class="headerlink" title="自定义注解处理所用的常用元素与常用接口介绍"></a><a href="http://zksyp.me/2017/05/20/2017-05-22/" target="_blank" rel="external">自定义注解处理所用的常用元素与常用接口介绍</a></h4></li>
</ul>
<h4 id="3-注册自定义注解处理器"><a href="#3-注册自定义注解处理器" class="headerlink" title="3 注册自定义注解处理器"></a>3 注册自定义注解处理器</h4><p>在自定义注解处理器编写完成后，我们还需要注册这个处理器，不然编译器在编译时是不能够处理的我们的自定义注解的。<br>注册有两种方法：<br>第一种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">1、在 process 工程的 main 目录下新建 resources 资源文件夹；</div><div class="line"></div><div class="line">2、在 resources文件夹下建立 META-INF/services 目录文件夹；</div><div class="line"></div><div class="line">3、在 META-INF/services 目录文件夹下创建 javax.annotation.process(工程名称).processor(自定义注解处理器名称) 文件；</div><div class="line"></div><div class="line">4、在 javax.annotation.process(工程名称).processor(自定义注解处理器名称)  文件写入注解处理器的全称，包括包路径；</div></pre></td></tr></table></figure>
<p>第二种：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1 在process工程的build里引入google官方的一个库&quot;com.google.auto.service:auto-service:1.0-rc2&quot;</div><div class="line">2 在自定义注解处理器的class头部添加 @AutoService注解，注解value为Processor.class。以上操作完成后它会自动生成注册注解处理器所需要的配置文件。</div></pre></td></tr></table></figure>
<p>之后编译运行即可。</p>
<h2 id="自定义BindViewDemo"><a href="#自定义BindViewDemo" class="headerlink" title="自定义BindViewDemo"></a>自定义BindViewDemo</h2><p>下面我将通过自定义的BindViewDemo来实战一下自定义注解。</p>
<h3 id="一-使用运行时自定义注解BindView"><a href="#一-使用运行时自定义注解BindView" class="headerlink" title="一 使用运行时自定义注解BindView"></a>一 使用运行时自定义注解BindView</h3><h4 id="第一步：自定义运行时BindView注解"><a href="#第一步：自定义运行时BindView注解" class="headerlink" title="第一步：自定义运行时BindView注解:"></a>第一步：自定义运行时BindView注解:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Target</span>(ElementType.FIELD)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView1 &#123;</div><div class="line">    <span class="meta">@IdRes</span><span class="comment">//使用该注解限定value值为资源ID</span></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="第二步：处理运行时BindView注解："><a href="#第二步：处理运行时BindView注解：" class="headerlink" title="第二步：处理运行时BindView注解："></a>第二步：处理运行时BindView注解：</h4><p>在View绑定的类中，这里我们是在Activity中，注解的用法与ButterKnife大致一样，只是在setContentView后，调用我们自己定义的AnnotateBindUtils.bind()方法。<br>其中大部分用到了<a href="http://www.brantyu.com/315.html" target="_blank" rel="external">反射的相关知识</a>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotateBindUtils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">        <span class="comment">//反射获取被绑定Activity的class</span></div><div class="line">        Class activityClass = activity.getClass();</div><div class="line">        <span class="comment">//获取该class上所有的声明字段</span></div><div class="line">        Field[] fields = activityClass.getDeclaredFields();</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> (Field field : fields) &#123;</div><div class="line">            <span class="comment">//筛选出由@BindView1注解的字段</span></div><div class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(BindView1.class)) &#123;</div><div class="line">                <span class="comment">//获取该注解实例</span></div><div class="line">                BindView1 bindView1 = field.getAnnotation(BindView1.class);</div><div class="line">                <span class="keyword">if</span> (bindView1 != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        <span class="comment">//通过方法名反射获取名为"findViewById"的方法</span></div><div class="line">                        Method method = activityClass.getMethod(<span class="string">"findViewById"</span>, <span class="keyword">int</span>.class);</div><div class="line">                        <span class="comment">//这个是跳过JDK的安全检查，提高发射效率</span></div><div class="line">                        method.setAccessible(<span class="keyword">true</span>);</div><div class="line">                        <span class="comment">//通过反射把相应的参数注入到方法中，这里也就完成了findViewById的操作,生成了一个绑定好ID的View</span></div><div class="line">                        Object resultView = method.invoke(activity, bindView1.value());</div><div class="line">                        field.setAccessible(<span class="keyword">true</span>);</div><div class="line">                        <span class="comment">//这里就是把上面那个View赋值给我们自己定义的View的变量</span></div><div class="line">                        field.set(activity, resultView);</div><div class="line">                    &#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException | NoSuchMethodException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125; </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上就是使用运行时注解绑定View的操作过程。</p>
<h3 id="二-使用编译时自定义注解BindView："><a href="#二-使用编译时自定义注解BindView：" class="headerlink" title="二 使用编译时自定义注解BindView："></a>二 使用编译时自定义注解BindView：</h3><p>这里的自定义注解的处理我参照了ButterKnife源码的使用方式。阅读源码，我发现。。ButterKnife在8.2.1版本前后绑定View的操作有略微的差别，区别的地方在于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">· (老版本类似的方法，老版本中生成了两个自定义.java文件，然后通过相互调用的方法完成，这里的方法一是简化版本)方法一定义了一个接口，让我们的绑定类实现这个接口,再实例化含有这个对象的绑定接口，把对象内的参数传入，然后在绑定接口的方法中去实现绑定View的操作。</div><div class="line">· 方法二是先建了一个类，把参数传入，再通过反射去获得这个类的构造函数，把绑定View的操作放在构造函数中，然后再通过反射获取的构造函数，去实例化一个对象，这样调用这个构造函数后，就完成了绑定操作。</div></pre></td></tr></table></figure>
<p>下面我会用这两种方式都实现一下。(以下的例子中，我只是抽出了findViewById的操作，其他的操作大致雷同，所以我这里就没有赘述了)。</p>
<h4 id="第一步：自定义编译时BindView注解"><a href="#第一步：自定义编译时BindView注解" class="headerlink" title="第一步：自定义编译时BindView注解:"></a>第一步：自定义编译时BindView注解:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//方法一对应的注解</span></div><div class="line"><span class="meta">@Target</span>(ElementType.FIELD)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.CLASS)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView3 &#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//方法二对应的注解</span></div><div class="line"><span class="meta">@Target</span>(ElementType.FIELD)</div><div class="line"><span class="meta">@Retention</span>(RetentionPolicy.CLASS)</div><div class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BindView4 &#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">value</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="第二步：处理编译时BindView注解"><a href="#第二步：处理编译时BindView注解" class="headerlink" title="第二步：处理编译时BindView注解:"></a>第二步：处理编译时BindView注解:</h4><h5 id="初始化操作与配置："><a href="#初始化操作与配置：" class="headerlink" title="初始化操作与配置："></a>初始化操作与配置：</h5><p><img src="http://og407vfi8.bkt.clouddn.com/14955324239403.jpg" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//指定处理的注解类(这里就是@BindView3和@BindView4)</span></div><div class="line"> <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Set&lt;String&gt; <span class="title">getSupportedAnnotationTypes</span><span class="params">()</span> </span>&#123;</div><div class="line">        Set&lt;String&gt; annotations = <span class="keyword">new</span> LinkedHashSet&lt;String&gt;();</div><div class="line">        annotations.add(BindView3.class.getCanonicalName());</div><div class="line">        annotations.add(BindView4.class.getCanonicalName());</div><div class="line">        <span class="keyword">return</span> annotations;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//指定使用的Java版本(这里使用的是最新的版本)</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> SourceVersion <span class="title">getSupportedSourceVersion</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> SourceVersion.latestSupported();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//初始化函数，获取所需要的工具类</span></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ProcessingEnvironment env)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.init(env);</div><div class="line">        elementUtils = env.getElementUtils();</div><div class="line">        filer = env.getFiler();</div><div class="line">        messager = env.getMessager();</div><div class="line">        typeUtils = env.getTypeUtils();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h5 id="注解处理："><a href="#注解处理：" class="headerlink" title="注解处理："></a>注解处理：</h5><p>首先我们需要建立两个类去管理我们解析出来的数据：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//对注解解析的数据进行操作的类</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewBindInjector</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> String packageName;</div><div class="line">    <span class="keyword">private</span> String targetClassName;</div><div class="line">    <span class="keyword">private</span> TypeElement typeElement;</div><div class="line">    <span class="keyword">private</span> String suffixClassName;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIXONE = <span class="string">"$$BINDVIEWONE"</span>;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIXTWO = <span class="string">"$$BINDVIEWTWO"</span>;</div><div class="line">    <span class="keyword">private</span> Map&lt;Integer, ViewInfo&gt; idViewMapOne = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> Map&lt;Integer, ViewInfo&gt; idViewMapTwo = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="comment">//传入解析到的相关信息：包名 类名</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewBindInjector</span><span class="params">(String packageName, String className, <span class="keyword">boolean</span> isOne)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.packageName = packageName;</div><div class="line">        <span class="keyword">this</span>.targetClassName = className;</div><div class="line">        String str = isOne ? SUFFIXONE : SUFFIXTWO;</div><div class="line">        <span class="keyword">this</span>.suffixClassName = className + str;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getClassFullName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> packageName + <span class="string">"."</span> + suffixClassName;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putViewInfo</span><span class="params">(<span class="keyword">int</span> id, ViewInfo viewInfo, <span class="keyword">boolean</span> isOne)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (isOne) &#123;</div><div class="line">            idViewMapOne.put(id, viewInfo);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            idViewMapTwo.put(id, viewInfo);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//这个是方法一的.java文件生成，其实就是我们自己按照正确的语法格式把字符串拼接(ButterKnife中用的是https://github.com/square/javapoet库来生成代码的)</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brewJavaOne</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        builder.append(<span class="string">"// Generated code from BindViewTest. Do not modify!\n"</span>);</div><div class="line">        builder.append(<span class="string">"package "</span>).append(packageName).append(<span class="string">";\n\n"</span>);</div><div class="line">        builder.append(<span class="string">"import android.view.View;\n"</span>);</div><div class="line">        builder.append(<span class="string">"import com.zksyp.lib_bind.Finder;\n"</span>);</div><div class="line">        builder.append(<span class="string">"import com.zksyp.lib_bind.AbstractBinder;\n"</span>);</div><div class="line">        builder.append(<span class="string">'\n'</span>);</div><div class="line"></div><div class="line">        builder.append(<span class="string">"public class "</span>).append(suffixClassName);</div><div class="line">        builder.append(<span class="string">"&lt;T extends "</span>).append(getTargetClassName()).append(<span class="string">"&gt;"</span>);</div><div class="line">        builder.append(<span class="string">" implements AbstractBinder&lt;T&gt;"</span>);</div><div class="line">        builder.append(<span class="string">" &#123;\n"</span>);</div><div class="line"></div><div class="line">        builder.append(generateInjectMethodOne());</div><div class="line">        builder.append(<span class="string">"\n"</span>);</div><div class="line">        builder.append(<span class="string">" &#125;\n"</span>);</div><div class="line">        <span class="keyword">return</span> builder.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 方法一所包含的方法(继承我们定义的接口)</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">generateInjectMethodOne</span><span class="params">()</span> </span>&#123;</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line"></div><div class="line">        sb.append(<span class="string">" @Override "</span>).append(<span class="string">"public void bind(final Finder finder, final T target, Object source) &#123;\n"</span>);</div><div class="line">        sb.append(<span class="string">"  View view;\n"</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> key : idViewMapOne.keySet()) &#123;</div><div class="line">            ViewInfo viewInfo = idViewMapOne.get(key);</div><div class="line">            sb.append(<span class="string">"  view = "</span>);</div><div class="line">            sb.append(<span class="string">"finder.findViewById(source , "</span>);</div><div class="line">            sb.append(viewInfo.getId()).append(<span class="string">" );\n"</span>);</div><div class="line">            sb.append(<span class="string">"  target."</span>).append(viewInfo.getName()).append(<span class="string">" = "</span>);</div><div class="line">            sb.append(<span class="string">"finder.castView( view "</span>).append(<span class="string">", "</span>).append(viewInfo.getId()).append(<span class="string">" , \""</span>);</div><div class="line">            sb.append(viewInfo.getName() + <span class="string">" \" );"</span>);</div><div class="line">        &#125;</div><div class="line">        sb.append(<span class="string">" &#125;\n"</span>);</div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//这个是方法二的.java文件生成</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">brewJavaTwo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        builder.append(<span class="string">"// Generated code from BindViewTest. Do not modify!\n"</span>);</div><div class="line">        builder.append(<span class="string">"package "</span>).append(packageName).append(<span class="string">";\n\n"</span>);</div><div class="line">        builder.append(<span class="string">"import android.view.View;\n"</span>);</div><div class="line">        builder.append(<span class="string">"import com.zksyp.lib_bind.Utils;\n"</span>);</div><div class="line">        builder.append(<span class="string">'\n'</span>);</div><div class="line">        builder.append(<span class="string">"public class "</span>).append(suffixClassName);</div><div class="line">        builder.append(<span class="string">" &#123;\n"</span>);</div><div class="line">        builder.append(<span class="string">"  private "</span>).append(getTargetClassName()).append(<span class="string">" target;\n\n"</span>);</div><div class="line">        builder.append(generateInjectMethodTwo());</div><div class="line">        builder.append(<span class="string">"\n"</span>);</div><div class="line">        builder.append(<span class="string">" &#125;\n"</span>);</div><div class="line">        <span class="keyword">return</span> builder.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 方法二中包含的方法</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">generateInjectMethodTwo</span><span class="params">()</span> </span>&#123;</div><div class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</div><div class="line"></div><div class="line">        sb.append(<span class="string">"  public "</span>).append(suffixClassName).append(<span class="string">"("</span>).append(getTargetClassName())</div><div class="line">                .append(<span class="string">" target"</span>).append(<span class="string">") &#123;\n"</span>).append(<span class="string">"   this(target, target.getWindow().getDecorView());\n  &#125;\n\n"</span>);</div><div class="line"></div><div class="line">        sb.append(<span class="string">"  public "</span>).append(suffixClassName).append(<span class="string">"("</span>).append(getTargetClassName())</div><div class="line">                .append(<span class="string">" target"</span>).append(<span class="string">", View source"</span>).append(<span class="string">") &#123;\n"</span>).append(<span class="string">"   this.target = target;\n\n"</span>);</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> key : idViewMapTwo.keySet()) &#123;</div><div class="line">            ViewInfo viewInfo = idViewMapTwo.get(key);</div><div class="line">            sb.append(<span class="string">"   target."</span>).append(viewInfo.getName()).append(<span class="string">" = "</span>)</div><div class="line">                    .append(<span class="string">"Utils.findRequiredViewAsType(source, "</span>).append(viewInfo.getId())</div><div class="line">                    .append(<span class="string">", \"field "</span>).append(<span class="string">"\'"</span>).append(viewInfo.getName()).append(<span class="string">"'\'\""</span>)</div><div class="line">                    .append(<span class="string">", "</span>).append(viewInfo.getType()).append(<span class="string">".class"</span>).append(<span class="string">");\n"</span>)</div><div class="line">                    .append(<span class="string">"  &#125;\n"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sb.toString();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTypeElement</span><span class="params">(TypeElement typeElement)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.typeElement = typeElement;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> TypeElement <span class="title">getTypeElement</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> typeElement;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getTargetClassName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> targetClassName.replace(<span class="string">"$"</span>, <span class="string">"."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//保存被注解变量的信息</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewInfo</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="keyword">private</span> String type;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewInfo</span><span class="params">(<span class="keyword">int</span> id, String name, String type)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.id = id;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> type;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>.type = type;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h5><h6 id="编译生成的文件"><a href="#编译生成的文件" class="headerlink" title="编译生成的文件"></a>编译生成的文件</h6><p>编译文件的位置：AS-Project文件模式下，<code>工程名/app/build/generated/source/apt／项目名</code>的文件夹中。<br><img src="http://og407vfi8.bkt.clouddn.com/14955889121322.jpg" alt=""></p>
<h6 id="前期处理："><a href="#前期处理：" class="headerlink" title="前期处理："></a>前期处理：</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div></pre></td><td class="code"><pre><div class="line"> <span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//获取注解解析数据的Map</span></div><div class="line">    Map&lt;String, ViewBindInjector&gt; targetViewMapOne = findAndParseTargetsOne(roundEnv);</div><div class="line">    <span class="keyword">for</span> (String key : targetViewMapOne.keySet()) &#123;</div><div class="line">       <span class="comment">//取出Map对象中的值</span></div><div class="line">        ViewBindInjector bindInjector = targetViewMapOne.get(key);</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//通过我们的filer工具类生成我们自己定义的.java文件然后供运行时运行，文件名就是Activity的类名加上一串混淆符号(这个混淆符号是我们自己定义的)</span></div><div class="line">            JavaFileObject jfo = filer.createSourceFile(bindInjector.getClassFullName()</div><div class="line">                    , bindInjector.getTypeElement());</div><div class="line">            Writer w = jfo.openWriter();</div><div class="line">            <span class="comment">//这个是ViewBindInjector的方法生成的.java文件的中内容</span></div><div class="line">            w.write(bindInjector.brewJavaOne());</div><div class="line">            w.flush();</div><div class="line">            w.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            error(bindInjector.getTypeElement(), <span class="string">"Unable to bind for type %s: %s"</span></div><div class="line">                    , bindInjector.getTypeElement(), e.getMessage());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//获取获取注解解析数据的Map的方法</span></div><div class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, ViewBindInjector&gt; <span class="title">findAndParseTargetsOne</span><span class="params">(RoundEnvironment env)</span> </span>&#123;</div><div class="line">    Map&lt;String, ViewBindInjector&gt; targetViewMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="comment">//获取被指定注解的注解的元素</span></div><div class="line">    <span class="keyword">for</span> (Element ele : env.getElementsAnnotatedWith(BindView3.class)) &#123;</div><div class="line">       <span class="comment">//把该元素的相关内容打印出来，打印的日志可在AS的Gradle Console中看到</span></div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"ele = "</span> + ele);</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"eleType = "</span> + ele.asType());</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"eleKind = "</span> + ele.getKind());</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"eleSimpleName = "</span> + ele.getSimpleName());</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"eleEnclosing = "</span> + ele.getEnclosingElement());</div><div class="line"></div><div class="line">        <span class="comment">//获取该元素的类型元素</span></div><div class="line">        TypeElement classElement = (TypeElement) ele.getEnclosingElement();</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"classEle = "</span> + classElement);</div><div class="line"></div><div class="line">        <span class="comment">//获取该元素的包元素</span></div><div class="line">        PackageElement packageElement = elementUtils.getPackageOf(classElement);</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"packageEle = "</span> + packageElement);</div><div class="line"></div><div class="line">        <span class="comment">//得到全名，包名，类名</span></div><div class="line">        String fqClassName = classElement.getQualifiedName().toString();</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"fqClassName = "</span> + fqClassName);</div><div class="line"></div><div class="line">        String packageName = packageElement.getQualifiedName().toString();</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"packageName = "</span> + packageName);</div><div class="line"></div><div class="line">        String className = getClassName(classElement, packageName);</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"className = "</span> + className);</div><div class="line"></div><div class="line">        <span class="comment">//获取该元素字段</span></div><div class="line">        VariableElement varEle = (VariableElement) ele;</div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE, <span class="string">"varEle = "</span> + varEle);</div><div class="line"></div><div class="line">        <span class="comment">//获取绑定的ID值 字段名称 字段类型</span></div><div class="line">        <span class="keyword">int</span> id = varEle.getAnnotation(BindView3.class).value();</div><div class="line">        String fieldName = varEle.getSimpleName().toString();</div><div class="line">        String fieldType = varEle.asType().toString();</div><div class="line"></div><div class="line">        messager.printMessage(Diagnostic.Kind.NOTE,</div><div class="line">                <span class="string">"annotation field : fieldName = "</span> + fieldName + <span class="string">" , id = "</span> + id</div><div class="line">                        + <span class="string">" , fieldType = "</span> + fieldType);</div><div class="line">        ViewBindInjector bindInjector = targetViewMap.get(fqClassName);</div><div class="line"></div><div class="line">        <span class="comment">//生成bindInjector对象并把它存入Map中并校验防止重复绑定</span></div><div class="line">        <span class="keyword">if</span> (bindInjector == <span class="keyword">null</span>) &#123;</div><div class="line">            bindInjector = <span class="keyword">new</span> ViewBindInjector(packageName, className, <span class="keyword">true</span>);</div><div class="line">            targetViewMap.put(fqClassName, bindInjector);</div><div class="line">            bindInjector.setTypeElement(classElement);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        bindInjector.putViewInfo(id, <span class="keyword">new</span> ViewInfo(id, fieldName, fieldType), <span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> targetViewMap;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面提到的接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbstractBinder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(Finder finder, T target, Object resource)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面提到的类型Finder：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Finder &#123;</div><div class="line"><span class="comment">//这里调用绑定View的方法</span></div><div class="line">    VIEW &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">findViewById</span><span class="params">(Object source, <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> ((View) source).findViewById(id);</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    ACTIVITY &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> View <span class="title">findViewById</span><span class="params">(Object source, <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> ((Activity) source).findViewById(id);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">castView</span><span class="params">(View view, <span class="keyword">int</span> id, String who)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> (T) view;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> View <span class="title">findViewById</span><span class="params">(Object source, <span class="keyword">int</span> id)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="调用方法：BindViewTest-bind"><a href="#调用方法：BindViewTest-bind" class="headerlink" title="调用方法：BindViewTest.bind()"></a>调用方法：BindViewTest.bind()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BindViewTest</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, AbstractBinder&lt;Object&gt;&gt; BINDERS = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">        <span class="comment">//获取含有指定对象的接口实例</span></div><div class="line">        AbstractBinder&lt;Object&gt; binder = findBinder(activity);</div><div class="line">        <span class="comment">//调用绑定方法，绑定View</span></div><div class="line">        binder.bind(Finder.ACTIVITY, activity, activity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(View view)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">(Object target, View view)</span> </span>&#123;</div><div class="line">        AbstractBinder&lt;Object&gt; binder = findBinder(target);</div><div class="line">        binder.bind(Finder.VIEW, target, view);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> AbstractBinder&lt;Object&gt; <span class="title">findBinder</span><span class="params">(Object activity)</span> </span>&#123;</div><div class="line">        Class&lt;?&gt; clazz = activity.getClass();</div><div class="line">        AbstractBinder&lt;Object&gt; binder = BINDERS.get(clazz);</div><div class="line">        Log.e(<span class="string">"className"</span>, clazz.getSimpleName());</div><div class="line">        <span class="keyword">if</span> (binder == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">//根据混淆类名获取我们自定义的类(也就是那个.java文件)</span></div><div class="line">                Class binderClazz = Class.forName(clazz.getName() + ViewBindInjector.SUFFIXONE);</div><div class="line">                binder = (AbstractBinder&lt;Object&gt;) binderClazz.newInstance();</div><div class="line">                <span class="keyword">if</span> (binder != <span class="keyword">null</span>) &#123;</div><div class="line">                    Log.e(<span class="string">"binder"</span>, binder.toString());</div><div class="line">                &#125;</div><div class="line">                BINDERS.put(clazz, binder);</div><div class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException | InstantiationException | IllegalAccessException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> binder;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h5><p>方法二与方法一的前期处理过程是一样的，这里就不赘述了</p>
<h6 id="编译生成的文件-1"><a href="#编译生成的文件-1" class="headerlink" title="编译生成的文件"></a>编译生成的文件</h6><p><img src="http://og407vfi8.bkt.clouddn.com/14955888724855.jpg" alt=""></p>
<h6 id="抽出来的工具类方法："><a href="#抽出来的工具类方法：" class="headerlink" title="抽出来的工具类方法："></a>抽出来的工具类方法：</h6><p>这里ButterKnife抽出来了一个工具类，在里面定义绑定View的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//这些方法是从ButterKnife中抽出来的，传入相应参数执行绑定View的操作</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Utils</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">findRequiredViewAsType</span><span class="params">(View source, @IdRes <span class="keyword">int</span> id, String who,</span></span></div><div class="line">                                               Class&lt;T&gt; cls) &#123;</div><div class="line">        View view = findRequiredView(source, id, who);</div><div class="line">        <span class="keyword">return</span> castView(view, id, who, cls);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">findOptionalViewAsType</span><span class="params">(View source, @IdRes <span class="keyword">int</span> id, String who,</span></span></div><div class="line">                                               Class&lt;T&gt; cls) &#123;</div><div class="line">        View view = source.findViewById(id);</div><div class="line">        <span class="keyword">return</span> castView(view, id, who, cls);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> View <span class="title">findRequiredView</span><span class="params">(View source, @IdRes <span class="keyword">int</span> id, String who)</span> </span>&#123;</div><div class="line">        View view = source.findViewById(id);</div><div class="line">        <span class="keyword">if</span> (view != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> view;</div><div class="line">        &#125;</div><div class="line">        String name = getResourceEntryName(source, id);</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Required view '"</span></div><div class="line">                + name</div><div class="line">                + <span class="string">"' with ID "</span></div><div class="line">                + id</div><div class="line">                + <span class="string">" for "</span></div><div class="line">                + who</div><div class="line">                + <span class="string">" was not found. If this view is optional add '@Nullable' (fields) or '@Optional'"</span></div><div class="line">                + <span class="string">" (methods) annotation."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getResourceEntryName</span><span class="params">(View view, @IdRes <span class="keyword">int</span> id)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (view.isInEditMode()) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"&lt;unavailable while editing&gt;"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> view.getContext().getResources().getResourceEntryName(id);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">castView</span><span class="params">(View view, @IdRes <span class="keyword">int</span> id, String who, Class&lt;T&gt; cls)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">return</span> cls.cast(view);</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassCastException e) &#123;</div><div class="line">            String name = getResourceEntryName(view, id);</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"View '"</span></div><div class="line">                    + name</div><div class="line">                    + <span class="string">"' with ID "</span></div><div class="line">                    + id</div><div class="line">                    + <span class="string">" for "</span></div><div class="line">                    + who</div><div class="line">                    + <span class="string">" was of the wrong type. See cause for more info."</span>, e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Utils</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"No instances."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="调用方法：BindViewTest2"><a href="#调用方法：BindViewTest2" class="headerlink" title="调用方法：BindViewTest2()"></a>调用方法：BindViewTest2()</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BindViewTest2</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, Constructor&lt;?&gt;&gt; BINDERS = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">bind</span><span class="params">(Activity target)</span> </span>&#123;</div><div class="line">        <span class="comment">//获取我们自定义的类的构造方法(也就是那个.java文件)</span></div><div class="line">        Constructor&lt;?&gt; bindCtr = findBinderCtr(target);</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//调用构造方法,绑定View</span></div><div class="line">            <span class="keyword">return</span> bindCtr.newInstance(target, target.getWindow().getDecorView());</div><div class="line">        &#125; <span class="keyword">catch</span> (InstantiationException | IllegalAccessException | InvocationTargetException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Constructor&lt;?&gt; findBinderCtr(Activity target) &#123;</div><div class="line">        Class&lt;?&gt; clazz = target.getClass();</div><div class="line">        Constructor&lt;?&gt; bindCtr = BINDERS.get(clazz);</div><div class="line">        <span class="keyword">if</span> (bindCtr == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">//根据混淆类名获取构造函数</span></div><div class="line">                Class binderClazz = Class.forName(clazz.getName() + ViewBindInjector.SUFFIXTWO);</div><div class="line">                bindCtr = (Constructor&lt;?&gt;) binderClazz.getConstructor(clazz, View.class);</div><div class="line">                BINDERS.put(clazz, bindCtr);</div><div class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> bindCtr;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上就是使用编译时注解绑定View的操作过程。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>1 注解主要就是根据你自己制定的策略去生成相关的代码，避免写许多的重复代码，提高工作效率。(当然有时候也需要在性能与效率之间做一个取舍)。<br>2 生成的代码，还是需要自己去主动调用的，这个和代码的插入不一样。<br>3 APT其实是一套非常强大的机制，后续将会跟进了解。<br>4 ButterKnife 框架的原理其实通过整篇文章下来，大致都能够了解，但其很大一部分的精力都放在了对元素的校验和容错上面，其实这也是许多开源框架的着重点，因为作为一个开源的框架，想要更多的人去用，稳定是最主要的。<br><a href="https://github.com/zksyp/AnnotationTest" target="_blank" rel="external">最后附上Demo的GitHub地址</a></p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2017/05/20/2017-05-22/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/05/09/2017-05-09/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Zksyp's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        shmilyzksyp@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: shmilyzksyp@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/Android/">Android<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/Hexo/">Hexo<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/Java/">Java<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/categories/日常/">日常<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                时间轴
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="我的小伙伴">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                我的小伙伴
            </a>
        </li>
        
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                标签
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">12</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/zksyp" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Zksyp的博客
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
